{% load static %}

<!doctype html>
<html lang="en">
    <head>
        <title>Pain Tracker</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    </head>

    <style>
        .cuerpoHumano {
            position: relative;
            display: inline-block;
            text-align: center;
            align-items: center;
            justify-content: center;
        }
        
        .parteCuerpo {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease; 
            border: 2px solid transparent; 
        }

        .parteCuerpo:hover {
            background-color: rgba(0, 123, 255, 0.3); 
            border: 2px solid #0056b3; 
            border-radius: 4px; 
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.5); 
        }

        /* Nuevos estilos para los niveles de dolor */
        .dolor-baja {
            background-color: rgba(200, 230, 201, 0.5) !important;
            border: 2px solid #81c784 !important;
        }

        .dolor-media {
            background-color: rgba(255, 243, 224, 0.5) !important;
            border: 2px solid #ffb74d !important;
        }

        .dolor-alta {
            background-color: rgba(255, 205, 210, 0.5) !important;
            border: 2px solid #e57373 !important;
        }

        .table {
            margin-top: 20px;
        }
        
        .form-select {
            width: 100%;
        }
        
        .form-select option[value="baja"] {
            background-color: #c8e6c9;
        }
        
        .form-select option[value="media"] {
            background-color: #fff3e0;
        }
        
        .form-select option[value="alta"] {
            background-color: #ffcdd2;
        }
    </style>
    <body>
        <header></header>
        <main>
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <form action="">
                            <center>
                                <div class="cuerpoHumano" id="cuerpoHumano">
                                    <img src="{% static 'image/cuerpo.jfif' %}" alt="" srcset="">
                                </div>
                            </center>
                        </form>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-bordered mt-3">
                            <thead>
                                <tr>
                                    <th>Parte del Cuerpo</th>
                                    <th>Intensidad de Dolor</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="minitablita">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
        <footer></footer>

        <script>
            const cuerpo = document.getElementById("cuerpoHumano");
            const partesDelCuerpo = [
                //VISTA FRONTAL
                { nombre: "Cara", x: 42, y: 0, ancho: 34, alto: 51 },  // Cabeza FRONTAL
                { nombre: "Cuello ", x: 29, y: 50,ancho :52,alto:20}, // cuello FRONTAL
                { nombre: "Pectoral derecho", x: 23, y: 70, ancho: 35, alto: 39 }, // Pectoral Izquierdo FRONTAL
                { nombre: "Pectoral izquierdo", x: 58, y: 70, ancho: 35, alto: 39 }, // Pectoral derecho FRONTAL
                { nombre: "Hombro derecho", x: 4, y: 70, ancho: 19, alto: 39 }, // Hombro izquierdo FRONTAL
                { nombre: "Hombro izquierdo", x: 92, y: 70, ancho: 19, alto: 39 }, // Hombro derecho FRONTAL
                { nombre: "Brazo derecho", x: 4, y: 108, ancho: 22, alto: 40 }, // Brazo izquierdo FRONTAL
                { nombre: "Brazo izquierdo", x: 92, y: 108, ancho: 21, alto: 40 }, // Brazo derecho FRONTAL
                { nombre: "Antebrazo derecho", x: 1, y: 148, ancho: 24, alto: 60 }, // Antebrazo izquierdo FRONTAL
                { nombre: "Antebrazo izquierdo", x: 92, y: 148, ancho: 24, alto: 60 }, // Antebrazo derecho FRONTAL
                { nombre: "Mano derecha", x: 0, y: 207, ancho: 20, alto: 39 }, // Man izquierdo FRONTAL
                { nombre: "Mano izquierda", x: 97, y: 207, ancho: 20, alto: 39 }, // Man derecho FRONTAL
                { nombre: "Abdomen Superior derecho", x: 28, y: 109, ancho: 31, alto: 40 }, // Abdomen Superior Izquierdo FRONTAL
                { nombre: "Abdomen Superior izquierdo", x: 58, y: 109, ancho: 32, alto: 40 }, // Abdomen Superior Derecho FRONTAL
                { nombre: "Abdomen Inferior derecho", x: 28, y: 149, ancho: 31, alto: 28 }, // Abdomen Inferior Izquierdo FRONTAL
                { nombre: "Abdomen Inferior izquierdo", x: 58, y: 149, ancho: 32, alto: 28 }, // Abdomen Inferior Derecho FRONTAL
                { nombre: "Pelvis", x: 27, y: 176, ancho: 63, alto: 27 }, // Pelvis FRONTAL
                { nombre: "Genitales", x: 52, y: 202, ancho: 13, alto: 8 }, // Genitales FRONTAL
                { nombre: "Muslo derecho", x: 24, y: 202, ancho: 29, alto: 85 }, // Muslo Izquierdo FRONTAL
                { nombre: "Muslo izquierdo", x: 64, y: 202, ancho: 29, alto: 85 }, // Muslo Derecho FRONTAL
                { nombre: "Rodilla derecha", x: 27, y: 287, ancho: 29, alto: 20 }, // Rodilla Izquiera FRONTAL
                { nombre: "Rodilla izquierda", x: 64, y: 287, ancho: 29, alto: 20 }, // Rodilla Derecha FRONTAL
                { nombre: "Pierna derecha", x: 27, y: 307, ancho: 26, alto: 93 }, // Pierna Izquierdo FRONTAL
                { nombre: "Pierna izquierda", x: 64, y: 307, ancho: 26, alto: 93 }, // Pierna Derecho FRONTAL
                { nombre: "Talon derecha", x: 29, y: 400, ancho: 24, alto: 12 }, // Talon Izquierdo FRONTAL
                { nombre: "Talon izquierda", x: 64, y: 400, ancho: 26, alto: 12 }, // Talon Derecho FRONTAL 
                { nombre: "Pie derecho", x: 29, y: 412, ancho: 24, alto: 37 }, // Pie Izquierdo FRONTAL
                { nombre: "Pie izquierdo", x: 64, y: 412, ancho: 26, alto: 37 }, // Pie Derecho FRONTAL
                //VISTA TRASERA
                { nombre: "Cabeza", x: 211, y: 0, ancho: 34, alto: 51 },  // Cabeza TRASERA
                { nombre: "cuello", x: 198, y: 50, ancho: 52, alto: 20 }, // cuello TRASERA
                { nombre: "Espalda Alta", x: 192, y: 70, ancho: 70, alto: 70 }, // Espalda Alta
                { nombre: "Hombro izquierdo", x: 173, y: 70, ancho: 19, alto: 39 }, // Hombro izquierdo TRASERA
                { nombre: "Hombro derecho", x: 261, y: 70, ancho: 19, alto: 39 }, // Hombro derecho TRASERA
                { nombre: "Brazo izquierdo", x: 173, y: 108, ancho: 22, alto: 40 }, // Brazo izquierdo TRASERA
                { nombre: "Brazo izquierdo", x: 261, y: 108, ancho: 21, alto: 40 }, // Brazo derecho TRASERA
                { nombre: "Antebrazo izquierdo", x: 170, y: 148, ancho: 24, alto: 60 }, // Antebrazo izquierdo TRASERA
                { nombre: "Antebrazo derecho", x: 261, y: 148, ancho: 24, alto: 60 }, // Antebrazo derecho TRASERA
                { nombre: "Man izquierda", x: 169, y: 207, ancho: 20, alto: 39 }, // Man izquierdo TRASERA
                { nombre: "Mano derecha", x: 266, y: 207, ancho: 20, alto: 39 }, // Man derecho TRASERA
                { nombre: "Espalda Baja", x: 197, y: 140, ancho: 63, alto: 32 }, // Abdomen Inferior Izquierdo TRASERA
                { nombre: "Gluteo Izquierdo", x: 196, y: 176, ancho: 30, alto: 27 }, // Pelvis TRASERA
                { nombre: "Gluteo Derecho", x: 226, y: 176, ancho: 33, alto: 27 }, // Pelvis TRASERA
                { nombre: "Muslo Izquierdo", x: 193, y: 202, ancho: 29, alto: 105 }, // Muslo Izquierdo TRASERA
                { nombre: "Muslo Derecho", x: 233, y: 202, ancho: 29, alto: 105 }, // Muslo Derecho TRASERA
                { nombre: "Pierna Izquierda", x: 196, y: 307, ancho: 26, alto: 93 }, // Pierna Izquierda TRASERA
                { nombre: "Pierna Derecha", x: 233, y: 307, ancho: 26, alto: 93 }, // Pierna Derecha TRASERA
                { nombre: "Pie Izquierdo", x: 198, y: 398, ancho: 24, alto: 50 }, // Pie Izquierdo TRASERA
                { nombre: "Pie Derecho", x: 233, y: 398, ancho: 26, alto: 50 }, // Pie Derecho TRASERA
            ];

            // Objeto para mantener un registro de los elementos creados
            const elementosPorNombre = {};

            function CrearPartesDelCuerpo() {
                partesDelCuerpo.forEach(parte => {
                    const parteElemento = document.createElement("div");
                    parteElemento.classList.add("parteCuerpo");
                    parteElemento.style.left = `${parte.x}px`;
                    parteElemento.style.top = `${parte.y}px`;
                    parteElemento.style.width = `${parte.ancho}px`;
                    parteElemento.style.height = `${parte.alto}px`;
                    parteElemento.setAttribute("title", parte.nombre);
                    parteElemento.setAttribute("data-nombre", parte.nombre);
                    
                    parteElemento.addEventListener("click", () => {
                        mostrarSelectorIntensidad(parte.nombre, parteElemento);
                    });

                    elementosPorNombre[parte.nombre] = parteElemento;
                    cuerpo.appendChild(parteElemento);
                });
            }

            function actualizarColorParte(elemento, intensidad) {
                // Primero removemos todas las clases de dolor
                elemento.classList.remove('dolor-baja', 'dolor-media', 'dolor-alta');
                
                // Añadimos la clase correspondiente según la intensidad
                if (intensidad) {
                    elemento.classList.add(`dolor-${intensidad.toLowerCase()}`);
                }
            }

            function mostrarSelectorIntensidad(nombreParte, elemento) {
                // Verificar si ya existe una fila para esta parte
                const filaExistente = Array.from(document.querySelectorAll('#minitablita tr')).find(
                    tr => tr.cells[0].textContent === nombreParte
                );

                if (filaExistente) {
                    alert('Esta parte del cuerpo ya ha sido seleccionada');
                    return;
                }

                const intensidades = ['Baja', 'Media', 'Alta'];
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${nombreParte}</td>
                    <td>
                        <select class="form-select">
                            <option value="">Seleccionar intensidad</option>
                            ${intensidades.map(intensidad => 
                                `<option value="${intensidad.toLowerCase()}">${intensidad}</option>`
                            ).join('')}
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-danger btn-sm">Eliminar</button>
                    </td>
                `;

                // Añadir event listener al select
                const select = tr.querySelector('select');
                select.addEventListener('change', (e) => {
                    actualizarColorParte(elemento, e.target.value);
                });

                // Añadir event listener al botón de eliminar
                const btnEliminar = tr.querySelector('button');
                btnEliminar.addEventListener('click', () => {
                    tr.remove();
                    actualizarColorParte(elemento, null);
                });

                document.getElementById('minitablita').appendChild(tr);
            }

            CrearPartesDelCuerpo();
        </script>

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
    </body>
</html>